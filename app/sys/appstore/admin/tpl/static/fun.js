if($(".app-uninstall").length>0&&$(".app-uninstall").on("click",(function(){var url=$(this).attr("data-url");layer.alert("卸载应用会删除应用文件和数据，请先做好备份！<br>卸载应用会删除应用文件和数据，请先做好备份！<br>卸载应用会删除应用文件和数据，请先做好备份！",{title:"提示"},(function(index){layer.close(index),LJS._get(url,(function(res){LJS._tips("卸载成功"),LJS._lazydo((function(){window.location.reload()}))}),"json")}))})),$(".app-update-btn").length>0){var applist=[];$("tbody tr").each((function(index){applist[index]=$(this).data()})),applist.length>0&&$.ajax({url:LCMS.url.own_form+"check&c=store",data:{applist:applist},type:"POST",dataType:"json",cache:!1,timeout:15e3,success:function(res){"1"==res.code?$("tbody tr").each((function(index){var verbox=$(this).children(".newver");if(verbox.length>0){var app=$(this).data();res.data[app.name]&&res.data[app.name].ver>app.ver?(verbox.html("V"+res.data[app.name].ver),$(this).find(".layui-btn-disabled").removeClass("layui-btn-disabled").addClass("app-update").html("立即更新").attr("data-ver",res.data[app.name].ver).attr("data-id",res.data[app.name].id)):verbox.html("V"+app.ver)}})):$("tbody tr").each((function(index){var verbox=$(this).children(".newver");verbox.length>0&&verbox.html("V"+$(this).data().ver)}))}}),$("table").on("click",".app-update",(function(){var appinfo=$(this).data();LJS._iframe(LCMS.url.own_form+"check&c=store&action=content&type=up&appid="+appinfo.id+"&appver="+appinfo.ver,"立即更新")}))}if($(".install-progress").length>0){var api=LCMS.url.own_form,appinfo=$(".install-progress").data(),tips=$(".install-tips");tips.html("正在获取需要下载的文件列表");var download=function(index){index<=appinfo.files?LJS._get(api+"install&action=get_files&appid="+appinfo.id+"&pack="+index+"&packs="+appinfo.files+"&appver="+appinfo.ver,(function(res){if("1"==res.code){var pre=Math.floor(index/appinfo.files*100);layui.element.progress("download",pre+"%"),index++,download(index)}else tips.html(res.msg),LJS._tips(res.msg,0)}),"json"):(tips.html("正在解压安装文件 请勿进行其它操作"),LJS._post(api+"install",{action:"copy_files",appid:appinfo.id,appname:appinfo.name,appver:appinfo.ver},(function(res){"1"==res.code?(tips.html("正在安装应用数据 请勿进行其它操作"),LJS._post(api+"install",{action:"get_data",appid:appinfo.id,appname:appinfo.name,appver:appinfo.ver,type:$(".install-progress").attr("data-type")},(function(res){"1"==res.code?(tips.html("安装成功 页面即将刷新"),LJS._lazydo((function(){parent.layer.closeAll(),"LBOX"==window.frameElement.getAttribute("id")?parent.location.href="index.php?t=sys&n=appstore&c=local&a=":window.location.reload()}),2e3)):tips.html("安装数据库失败")}),"json")):tips.html("解压文件失败")}),"json"))};LJS._post(api+"install",{action:"get_info",appid:appinfo.id,appver:appinfo.ver},(function(res){"1"==res.code?(appinfo=res.data).files>0?(tips.html("正在下载文件 请勿进行其它操作"),download(1)):LJS._tips("安装失败",0):LJS._tips(res.msg,0)}),"json")}