var _submit=function(){document.getElementById('login-btn').click()};layui.config({dir:LCMS["url"]["static"]+"layui/"});layui.use(["jquery","form"],function(){var $=layui.$,codeurl=$(".loginbox .__code").attr("src"),newcode=function(){$(".loginbox .__code").attr("src",codeurl+"&"+Math.random());$(".loginbox .__code").siblings("input").val("")};var _loadstart=function(){var index=layer.load(2,{shade:[0.3,"#fff"]});return index};var _loadend=function(index){layer.close(index)};layui.form.on("submit(login)",function(data){var loading=_loadstart();$.ajax({url:data.form.action,data:data.field,dataType:"json",cache:false,timeout:15000,success:function(res){if(res.code=="1"){layer.msg(res.msg,{icon:1,time:1000});setTimeout(function(){window.location.href=res.go},1000)}else{if(typeof(LUOCAPTCHA)=='object'){LUOCAPTCHA.reset()}else if(typeof(TENCENTCAPTCHA)=='object'){TENCENTCAPTCHA.reset()}else{newcode()}layer.msg(res.msg,{icon:2,anim:6,time:1000})}},error:function(){newcode();layer.msg("网络错误！",{icon:2,anim:6,time:1000})},complete:function(){_loadend(loading)}});return false});if($(".regbox").length>0){layui.form.verify({isname:function(value,item){var verifydata="";$.ajaxSettings.async=false;$.get("?n=login&c=reg&a=check&action=name&user="+value,function(res){verifydata=res},"json");$.ajaxSettings.async=true;if(verifydata.code!="1"){return verifydata.msg}},isemail:function(value,item){var verifydata="";$.ajaxSettings.async=false;$.get("?n=login&c=reg&a=check&action=email&email="+value,function(res){verifydata=res},"json");$.ajaxSettings.async=true;if(verifydata.code!="1"){return verifydata.msg}}});layui.form.on("submit(email)",function(data){var layercode=layer.open({type:1,title:"请输入验证码",area:["300px","260px"],content:$("#code").html()});$(".__sendemailcode").on("click",function(){var code=$(".__code").val();var user=$(".__user").val();var email=$(".__email").val();if(!code){layer.msg("请输入验证码",{icon:2,anim:6,time:1000});return false}var loading=_loadstart();$.ajax({url:data.form.action+"&action=emailcode",data:{"code":code,"user":user,"email":email},dataType:"json",cache:false,timeout:15000,success:function(res){if(res.code=="1"){layer.msg(res.msg,{icon:1,time:1000});_loadend(layercode)}else{layer.msg(res.msg,{icon:2,anim:6,time:1000})}},error:function(){layer.msg("网络错误！",{icon:2,anim:6,time:1000})},complete:function(){_loadend(loading)}})});return false});layui.form.on("submit(reg)",function(data){_loadend(loading);var loading=_loadstart();$.ajax({url:data.form.action,data:data.field,dataType:"json",cache:false,timeout:15000,success:function(res){if(res.code=="1"){layer.msg(res.msg,{icon:1,time:1000});setTimeout(function(){window.location.href="?n=login"},1000)}else{layer.msg(res.msg,{icon:2,anim:6,time:1000})}},error:function(){layer.msg("网络错误！",{icon:2,anim:6,time:1000})},complete:function(){_loadend(loading)}});return false})}});