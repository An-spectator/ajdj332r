<!DOCTYPE html>
<html>
    <head>
        <title>订单支付</title>
        <meta name="renderer" content="webkit"/>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
        <script type="text/javascript">var formatDecimal=function(num,decimal){num=num.toString();let index=num.indexOf('.');if(index!==-1){num=num.substring(0,decimal+index+1)}else{num=num.substring(0)}return parseFloat(num).toFixed(decimal)};var int_w=375,win_w=window.screen.width,meta=document.createElement('meta');document.querySelector('meta[name="viewport"]').remove();document.getElementsByTagName('head')[0].cssText='width:'+int_w+'px;overflow-x:hidden';meta.name='viewport';meta.content='width='+(win_w>=int_w?int_w:win_w)+', initial-scale='+formatDecimal(win_w/int_w,2)+', user-scalable=no';document.getElementsByTagName('head')[0].appendChild(meta);</script>
        <link href="data:image/ico;base64,aWNv" rel="shortcut icon" type="image/x-icon"/>
        <link rel="stylesheet" href="{{$_L['url']['static']}}amazeui/amazeui.min.css?{{$_L['config']['ver']}}"/>
        <style type="text/css">
        body,html{background-color:#f4f4f4;height:100%;width:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}img{max-width:100%}.pay-box ._title{height:100px;line-height:100px;text-align:center;background-color:#fff;border:1px #ccc dashed;border-bottom:none}.pay-box ._title img{width:200px}.pay-box ._body{padding:20px;background-color:#fff;border:1px #ccc dashed}.pay-box ._body h1{text-align:center;font-size:40px}.pay-box ._info{line-height:2;font-size:14px;margin-top:20px}.pay-box ._info p{margin:0}.pay-box ._info p.am-fr{color:#a0a0a0}.pay-btn{margin:0 0 20px 0}.pay-button,.pay-button:hover,.pay-button:focus,.pay-button:active{background:#fff;border:1px #ccc dashed;border-top:none;color:#409eff;padding:12px 0;margin:0;font-size:16px;font-weight:bold;box-shadow:none}
        </style>
    </head>
    <body>
        <div class="mescroll">
            <div class="pay-box" data-check="{{$_L['url']['own']}}n=system&c=pay&a=check&order_no={{$order['order_no']}}" data-goback="{{$order['return_url']}}">
                <div class="_title">
                    <img src="{{$_L['url']['site']}}core/plugin/payment/{{self::$payname}}/icon.png"/>
                </div>
                <div class="_body">
                    <h1>
                        ￥
                        <span>{{$order['pay']}}</span>
                    </h1>
                    <p style="color:red;text-align:center;">支付完成后，不要立即关闭页面<br>请等待自动确认订单状态！</p>
                    <div class="_info">
                        <div>
                            <p class="am-fl">商品名</p>
                            <p class="am-fr">{{$order['body']}}</p>
                            <div class="am-cf"> </div>
                        </div>
                        <div>
                            <p class="am-fl">订单金额</p>
                            <p class="am-fr">￥{{$order['pay']}}</p>
                            <div class="am-cf"> </div>
                        </div>
                        <div>
                            <p class="am-fl">商户单号</p>
                            <p class="am-fr">{{$order['order_no_own']}}</p>
                            <div class="am-cf"> </div>
                        </div>
                        <div>
                            <p class="am-fl">交易单号</p>
                            <p class="am-fr">{{$order['order_no']}}</p>
                            <div class="am-cf"> </div>
                        </div>
                        <div>
                            <p class="am-fl">下单时间</p>
                            <p class="am-fr">{{$order['addtime']}}</p>
                            <div class="am-cf"> </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pay-btn">
                <button class="am-btn am-btn-success am-btn-block pay-button" onclick="JSAPIPay()">立即支付</button>
            </div>
        </div>
        <script type="text/javascript" src="{{$_L['url']['static']}}jquery.min.js"></script>
        <script type="text/javascript" src="{{$_L['url']['static']}}layer/mlayer.js?{{$_L['config']['ver']}}"></script>
        <script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
        <script type="text/javascript" src="{{$_L['url']['static']}}../ui/web/static/ljs.js?{{$_L['config']['ver']}}"></script>
        <script type="text/javascript">
            wx.config({debug:false,appId:'{{$signpackage["appId"]}}',timestamp:'{{$signpackage["timestamp"]}}',nonceStr:'{{$signpackage["nonceStr"]}}',signature:'{{$signpackage["signature"]}}',jsApiList:['hideAllNonBaseMenuItem']});wx.ready(function(){wx.hideAllNonBaseMenuItem()});var jsApiCall=function(){WeixinJSBridge.invoke('getBrandWCPayRequest',JSON.parse('{{$result}}'),function(res){if(res.err_msg!="get_brand_wcpay_request:ok"){LJS._tips('支付失败',0)}})};var JSAPIPay=function(){if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener('WeixinJSBridgeReady',jsApiCall,false)}else if(document.attachEvent){document.attachEvent('WeixinJSBridgeReady',jsApiCall);document.attachEvent('onWeixinJSBridgeReady',jsApiCall)}}else{jsApiCall()}};var checkurl=$('.pay-box').attr('data-check');var goback=$('.pay-box').attr('data-goback');var second=0;var paycheck=setInterval(function(){second=second+1;if(second>200){clearInterval(paycheck);mlayer.alert({title:'提示',content:'支付超时，点击刷新按钮重新支付！',btn:'刷新',yes:function(index){location.reload()}})}else{$.get(checkurl,function(res){if(res.code=='1'){clearInterval(paycheck);LJS._tips(res.msg);LJS._lazydo(function(){if(goback=='goback'){window.history.go(-1)}else{window.location.href=goback}})}},'json')}},2000);
        </script>
    </body>
</html>