LJS._getjs(LCMS.url.static+'plugin/base64.min.js','','1');LJS._getjs(LCMS.url.static+'plugin/sortable.min.js','','1');LJS._getjs(LCMS.url.static+'Lrz4/lrz.bundle.js','','1');var LCMSTIPS=LJS._getQuery('lcmstips');if(LCMSTIPS){layui.notice.info(LCMSTIPS)};if($('#NAVTOP .__more').length>0){$('#NAVTOP .__mored dd').on('click',function(){top.history.pushState(null,null,'?'+$.base64.encode($(this).attr('data-url').match(/\?(.*)/)[0]));location.href=$(this).attr('data-url')})};if($('#APPNAV').length>0){if(self!=top){$('#APPNAV a').on('click',function(){top.history.pushState(null,null,'?'+$.base64.encode($(this).attr('href').match(/\?(.*)/)[0]))})}};if($('#APPTAB').length>0){if(self!=top){$('#APPTAB a').on('click',function(){top.history.pushState(null,null,'?'+$.base64.encode($(this).attr('href').match(/\?(.*)/)[0]))})}};if(!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){$('html,body').css({'max-width':window.screen.width})};if(LCMS.config.oss!='local'){var OSS_date=new Date();var OSS_base={datey:OSS_date.getFullYear().toString()+(OSS_date.getMonth()+1<10?'0'+(OSS_date.getMonth()+1):OSS_date.getMonth()+1),mime:function(name){var arr=name.split('.');return arr[arr.length-1]}};OSS_base.init=function(name,type){var time=OSS_date.getTime().toString();for(var i=0;i<3;i++){time+=Math.floor(Math.random()*10)};name=time+'.'+OSS_base.mime(name);OSS_base.name=name;OSS_base.file='upload/'+LCMS.ROOTID+'/'+type+'/'+OSS_base.datey+'/'+name};switch(LCMS.config.oss){case'qiniu':LJS._getjs(LCMS.url.site+'core/plugin/Qiniu/static/qiniu.min.js','','1');var OSS_qiniu=qiniu;LJS._get(LCMS.url.admin+'?n=upload&c=index&a=qiniu&action=token',function(res){if(res.code=='1'){OSS_base.token=res.data.token}},'json',true);var OSS_upload=function(type,File,success,error){type=type?type:'image';OSS_base.init(File.name,type);OSS_qiniu.upload(File,OSS_base.file,OSS_base.token,{},{useCdnDomain:true}).subscribe({error(res){LJS._tips(res.message,0);error&&error(res)},complete(){LJS._post(LCMS.url.admin+'index.php?n=upload&c=index&a=qiniu',{action:'success',type:type,name:OSS_base.name,file:OSS_base.file,datey:OSS_base.datey},function(res){if(res.code=='1'){success&&success(res)}else{LJS._tips(rst.msg,0);error&&error(res)}},'json')}})};break;case'tencent':LJS._getjs(LCMS.url.site+'core/plugin/Tencent/static/cos-js-sdk-v5.min.js','','1');var OSS_tencent;LJS._get(LCMS.url.admin+'?n=upload&c=index&a=tencent&action=token',function(res){if(res.code=='1'){OSS_base.token=res.data;var Token=res.data,Credentials=res.data.Credentials;OSS_tencent=new COS({SecretId:Credentials.TmpSecretId,SecretKey:Credentials.TmpSecretKey,XCosSecurityToken:Credentials.Token,})}},'json',true);var OSS_upload=function(type,File,success,error){type=type?type:'image';OSS_base.init(File.name,type);OSS_tencent.putObject({Bucket:OSS_base.token.Bucket,Region:OSS_base.token.Region,Key:OSS_base.file,Body:File},function(err,data){if(err){LJS._tips(err,0);error&&error(err)}else{LJS._post(LCMS.url.admin+'index.php?n=upload&c=index&a=tencent',{action:'success',type:type,name:OSS_base.name,file:OSS_base.file,datey:OSS_base.datey},function(res){if(res.code=='1'){success&&success(res)}else{LJS._tips(rst.msg,0);error&&error(res)}},'json')}})};break}}else{var LOC_upload=function(type,File,success,complete){type=type?type:'image';var upload=function(formData){$.ajax({url:LCMS.url.admin+'index.php?n=upload&c=index&a=local&type='+type,data:formData,processData:false,contentType:false,type:'POST',dataType:"json",success:function(res){success&&success(res)},error:function(){LJS._tips('上传接口异常',0)},complete:function(){complete&&complete()}})};var mime=File.type;if(mime=='image/jpg'||mime=='image/jpeg'){lrz(File,{width:1980}).then(function(res){upload(res.formData)})}else{var formData=new FormData();formData.append('file',File);upload(formData)}}};LJS._getjs('form.js',$('.layui-form'));LJS._getjs('select.js',$('.lcms-form-select'));LJS._getjs('selectN.js',$('.lcms-form-selectN'));LJS._getjs('tags.js',$('.lcms-form-tags'));LJS._getjs('color.js',$('.lcms-form-colorpicker'));LJS._getjs('slider.js',$('.lcms-form-slider'));LJS._getjs('date.js',$('.lcms-form-date'));LJS._getjs('upload.js',$('.lcms-form-upload-img'));LJS._getjs('file.js',$('.lcms-form-upload-file'));LJS._getjs('editor.js',$('.lcms-form-editor'));LJS._getjs('table.js',$('.lcms-form-table'));LJS._getjs('tree.js',$('.lcms-form-table-tree'));LJS._getjs('radio.js',$('.lcms-form-radio-tab'));LJS._getjs('spec.js',$('.lcms-form-spec'));LJS._getjs('icon.js',$('.lcms-form-icon'));LJS._getjs(LCMS.url.own_path+'admin/tpl/static/fun.js?ver='+(LCMS.app?LCMS.app.ver:''));layui.util.fixbar();