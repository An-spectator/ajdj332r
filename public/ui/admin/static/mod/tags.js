layui.extend({inputTags:'inputTags/inputTags'}).use(['inputTags'],function(){$('.lcms-form-tags').each(function(index){top.LCMSUIINDEX++;var _this=$(this),id='LCMSTAGS'+top.LCMSUIINDEX,ids='LCMSTAGSSORTABLE'+top.LCMSUIINDEX;_this.attr('id',id);_this.children('.lcms-form-tags-box').attr('id',ids);_this.children('.lcms-form-tags-button').show();if(_this.children('input').val()){_this.children('textarea').css({display:'block'})}else{_this.children('.lcms-form-tags-button').children('._first').css({display:'inline-block'})}layui.inputTags.render({elem:'#'+id});Sortable.create($('#'+ids)[0],{onUpdate:function(){var val=[];_this.children('.lcms-form-tags-box').find('em').text(function(index,content){val[index]=content});_this.children('input').val(val.join('|'))}})});$('.lcms-form-tags-button ._first').on('click',function(){var _this=$(this).parent('.lcms-form-tags-button');$(this).hide();_this.siblings('textarea').css({display:'block'}).focus()});$('.lcms-form-tags-button ._more').on('click',function(){let _this=$(this).parent('.lcms-form-tags-button'),tpl='<div><em>{val}</em><button type="button" class="close"><i class="layui-icon layui-icon-close"></i></button></div>',data=_this.siblings('input').val();layer.prompt({title:'请输入内容，标签每行一个或以 | 分割',formType:2,maxlength:2000},function(tags,index){let vi=0,vals=[];tags=tags.replace(/\r\n/g,'\n');tags=tags.split('\n');for(let i=0;i<tags.length;i++){let tag=tags[i];tag=tag.split('|');for(let ii=0;ii<tag.length;ii++){if(tag[ii]){_this.siblings('.lcms-form-tags-box').append(LJS._tpl(tpl,{val:tag[ii]}));vals[vi]=tag[ii];vi=vi+1}}};if(vals){vals=vals.join('|');if(data){vals='|'+vals};_this.siblings('input').val(data+vals);_this.siblings('textarea').css({display:'block'});_this.children('._first').hide()};layer.close(index)})});$('.lcms-form-tags-button ._delall').on('click',function(){var _this=$(this).parent('.lcms-form-tags-button');var tips=layer.alert("确认清空所有标签？",function(){_this.siblings('.lcms-form-tags-box').html('');_this.siblings('input').val('');_this.siblings('textarea').hide();_this.children('._first').css({display:'inline-block'});layer.close(tips)})})});